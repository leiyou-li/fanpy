# GitHub Actions 上游同步工作流

本项目包含两个GitHub Actions工作流，用于自动同步上游仓库 [PyramidStore](https://github.com/engd66/PyramidStore) 的最新内容。

## 工作流说明

### 1. 基础同步工作流 (`sync-upstream.yml`)
- **功能**: 基础的上游同步功能
- **运行时间**: 每天北京时间08:00 (UTC 00:00)
- **触发方式**: 
  - 定时触发
  - 手动触发

### 2. 高级同步工作流 (`sync-upstream-advanced.yml`) ⭐ 推荐
- **功能**: 包含更多高级特性的同步工作流
- **运行时间**: 
  - 每天北京时间08:00 (UTC 00:00)
  - 每周一额外备份运行
- **高级特性**:
  - 📊 详细的同步报告
  - 🔄 自动备份当前分支
  - 🚨 失败时自动创建Issue
  - 📈 提交统计和变更信息
  - 🛠️ 强制同步选项

## 使用方法

### 自动运行
工作流会按照设定的时间表自动运行，无需人工干预。

### 手动触发
1. 访问你的仓库的 Actions 页面
2. 选择对应的工作流
3. 点击 "Run workflow" 按钮
4. （高级版本）可选择是否强制同步

### 查看同步结果
- **成功**: 检查Actions页面的运行日志和摘要
- **失败**: 高级版本会自动创建Issue通知你

## 工作流行为说明

### 同步策略
1. **优先合并**: 尝试将上游变更合并到当前分支
2. **冲突处理**: 如果合并失败，会重置到上游最新版本
3. **备份保护**: 高级版本会在同步前创建备份分支

### 权限要求
工作流需要以下权限：
- `contents: write` - 修改仓库内容
- `pull-requests: write` - 创建PR（如果需要）
- `issues: write` - 创建Issue（失败通知）

### 安全考虑
- 使用 `--force-with-lease` 安全地强制推送
- 在重置前创建备份分支
- 所有操作都有详细日志记录

## 自定义配置

### 修改运行时间
编辑工作流文件中的 cron 表达式：
```yaml
schedule:
  - cron: '0 0 * * *'  # UTC时间，对应北京时间08:00
```

### 修改上游仓库
如果上游仓库地址发生变化，修改工作流文件中的仓库地址：
```yaml
git remote add upstream https://github.com/engd66/PyramidStore.git
```

## 故障排除

### 常见问题
1. **权限不足**: 确保仓库设置中启用了Actions并具有写权限
2. **合并冲突**: 高级版本会自动处理，基础版本可能需要手动解决
3. **网络问题**: GitHub Actions会自动重试

### 查看日志
访问 Actions 页面 → 选择失败的运行 → 查看详细日志

## 注意事项

⚠️ **重要提醒**:
- 同步会覆盖你对已有文件的修改
- 建议将你的自定义修改放在单独的分支中
- 高级版本会创建备份分支，但建议定期清理

💡 **最佳实践**:
- 使用高级版本以获得更好的监控和错误处理
- 定期检查同步状态和备份分支
- 如有重要修改，考虑向上游仓库提交PR

## 文件结构

```
.github/
└── workflows/
    ├── sync-upstream.yml          # 基础同步工作流
    └── sync-upstream-advanced.yml # 高级同步工作流 (推荐)
```

---

*最后更新: 2025-08-25*